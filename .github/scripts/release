#!/bin/bash -eux

v=$(head -n1 src/version)
releases=/repos/maddenp/nml/releases


gh api $releases                            \
   -F draft=false                           \
   -F generate_release_notes=false          \
   -F prerelease=false                      \
   -H "Accept: application/vnd.github+json" \
   -X POST                                  \
   -f name=$v                               \
   -f tag_name=$v                           \
   -f target_commitish=master

# gh api $releases/$v/assets?name=nml.jar     \
#    -H "Accept: application/vnd.github+json" \
#    -X POST                                  \
#    -f '@target/nml.jar'

curl                                                          \
  -X POST                                                     \
  -H "Accept: application/vnd.github+json"                    \
  -H "Authorization: Bearer $GH_TOKEN"                        \
  -H "X-GitHub-Api-Version: 2022-11-28"                       \
  -H "Content-Type: application/octet-stream"                 \
  https://uploads.github.com/$releases/$v/assets?name=nml.jar \
  --data-binary "@target/nml.jar"
